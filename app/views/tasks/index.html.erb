<h1>Listing tasks</h1>

<%= link_to 'New task', new_task_path %>

<br />
<br />

Status Filter: <%= link_to 'All', :filter => 'all', :owner => params[:owner], :organization => params[:organization], :project => params[:project] %>
| <%= link_to 'Scheduled', :filter => 'scheduled', :owner => params[:owner], :organization => params[:organization], :project => params[:project] %>
| <%= link_to 'Ongoing', :filter => 'ongoing', :owner => params[:owner], :organization => params[:organization], :project => params[:project]  %>
| <%= link_to 'Done', :filter => 'done', :owner => params[:owner], :organization => params[:organization], :project => params[:project]  %>

<br />

Owner Filter: <%= link_to 'All', :filter => params[:filter], :organization => params[:organization], :project => params[:project] %>
| <%= link_to 'Assigned to Me', :filter => params[:filter], :owner => current_user.name, :organization => params[:organization], :project => params[:project] %>

<br />

Organization Filter: <%= params[:organization] ? params[:organization] : 'N/A' %>

<br />

Project Filter: <%= params[:project] ? params[:project] : 'N/A' %>

<br />

<%= link_to 'Reset', tasks_path %>

<br />

<table>
	<tr>
		<th>Category</th>
		<th>Project</th>
		<th>Title</th>
		<th>Status</th>
		<th>Owner</th>
		<th>Organization</th>
		<th>Start Date</th>
		<th>Finish Date</th>
		<th>Est. Start Date</th>
		<th>Est. Finish Date</th>
		<th>Duration</th>
		<th>Est. Duration</th>
		<th></th>
		<th></th>
		<th></th>
	</tr>

<% @tasks.each do |task| %>
	<tr>
		<td> <%= task.category_name %> </td>
		<td> <%= task.project != nil ? (link_to task.project.name, task.project) : (link_to task.project_name, :filter => params[:filter], :owner => params[:owner], :organization => params[:organization], :project => task.project_name ) %> </td>
		<td> <%=h task.title %> </td>
		<td> <%=h task.status %> </td>
		<td> <%=h task.owner %> </td>
		<td> <%= link_to task.organization, :filter => params[:filter], :owner => params[:owner], :organization => task.organization, :project => params[:project] %> </td>
		<td> <%=h task.start_date %> </td>
		<td> <%=h task.finish_date %> </td>
		<td> <%=h task.estimated_start_date %> <%= if task.start_date == nil and task.estimated_start_date != nil and Date.today >= task.estimated_start_date then '<i>Late!</i>' end %></td>
		<td> <%=h task.estimated_finish_date %> <%= if task.finish_date == nil and task.estimated_finish_date != nil and Date.today >= task.estimated_finish_date then '<i>Late!</i>' end %></td>
		<td> <%=h task.duration %> </td>
		<td> <%=h task.estimated_duration %> </td>
		<td> <%= link_to 'Show', task %> </td>
		<td> <%= link_to 'Edit', edit_task_path(task) %> </td>
		<td> <%= link_to 'Destroy', task, :confirm => 'Are you sure?', :method => :delete %> </td>
  </tr>
<% end %>
</table>

<br />

<%= link_to 'New task', new_task_path %>
