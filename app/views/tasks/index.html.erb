<h1>Listing tasks</h1>

<%= link_to 'New task', new_task_path %>

<br />
<br />

Status Filter: <%= link_to 'All', :filter => 'all', :owner => params[:owner], :organization => params[:organization], :project => params[:project] %>
| <%= link_to 'Scheduled', :filter => 'scheduled', :owner => params[:owner], :organization => params[:organization], :project => params[:project] %>
| <%= link_to 'Ongoing', :filter => 'ongoing', :owner => params[:owner], :organization => params[:organization], :project => params[:project]  %>
| <%= link_to 'Done', :filter => 'done', :owner => params[:owner], :organization => params[:organization], :project => params[:project]  %>

<br />

Owner Filter: <%= link_to 'All', :filter => params[:filter], :organization => params[:organization], :project => params[:project] %>
| <%= link_to 'Assigned to Me', :filter => params[:filter], :owner => current_user, :organization => params[:organization], :project => params[:project] %>

<br />

Organization Filter: <%= params[:organization] ? params[:organization] : 'N/A' %>

<br />

Project Filter: <%= params[:project] ? params[:project] : 'N/A' %>

<br />

<%= link_to 'Reset', tasks_path %>

<br />

<table style="table-layout: fixed" width="1024">
    <colgroup>
        <col width="50">
        <col width="100">
        <col width="200">
        <col width="300">
        <col width="50">
        <col width="50">
        <col width="50">
        <col width="100">
        <col width="100">
        <col width="100">
        <col width="100">
        <col width="50">
        <col width="50">
    </colgroup>
	<tr>
		<th></th>
		<th>Category</th>
		<th>Project</th>
		<th>Title</th>
		<th>Status</th>
		<th>Owner</th>
		<th>Organization</th>
		<th>Start Date</th>
		<th>Finish Date</th>
		<th>Est. Start Date</th>
		<th>Est. Finish Date</th>
		<th>Duration</th>
		<th>Est. Duration</th>
	</tr>

<% @tasks.each do |task| %>
	<tr>
		<td> <%= link_to image_tag('vaga/file_edit.png', :border => 0), edit_task_path(task) %>
        <% if current_user.manager? %>
		<%= link_to image_tag('vaga/file_delete.png', :border => 0), task, :confirm => 'Are you sure?', :method => :delete %>
        <% end %>
        </td>
		<td> <%= task.category != nil ? (link_to task.category.name, task.category) : 'N/A' %> </td>
		<td> <%= task.project != nil ? (link_to task.project.name, task.project) : (link_to task.project_name, :filter => params[:filter], :owner => params[:owner], :organization => params[:organization], :project => task.project_name ) + ' (Unapproved)' %> </td>
		<td> <%= link_to task.title, task %> </td>
		<td> <%=h task.status.name %> </td>
		<td> <%= task.owner ? (link_to task.owner.name, :filter => params[:filter], :owner => task.owner, :organization => params[:organization], :project => params[:project]) : '-' %> </td>
		<td> <%= task.organization ? (link_to task.organization.name, :filter => params[:filter], :owner => params[:owner], :organization => task.organization, :project => params[:project]) : '-' %> </td>
		<td> <%=h task.start_date %> </td>
		<td> <%=h task.finish_date %> </td>
		<td> <%=h task.estimated_start_date %> <%= if task.start_date == nil and task.estimated_start_date != nil and Date.today >= task.estimated_start_date then '<i>Late!</i>' end %></td>
		<td> <%=h task.estimated_finish_date %> <%= if task.finish_date == nil and task.estimated_finish_date != nil and Date.today >= task.estimated_finish_date then '<i>Late!</i>' end %></td>
		<td> <%=h task.duration %> </td>
		<td> <%=h task.estimated_duration %> </td>
  </tr>
<% end %>
</table>

<br />

<%= link_to 'New task', new_task_path %>
